# 工程変更一覧画面 要件定義書

## 1. 画面概要

### 1.1 画面名
工程変更一覧画面

### 1.2 画面の目的
TC_変化点管理台帳に登録されている工程変更データを一覧表示し、検索・フィルタリング・詳細確認を可能にする。

### 1.3 画面タイプ
一覧表示画面（グリッド形式）

## 2. 画面構成

### 2.1 画面レイアウト
- **ヘッダー部**: 画面タイトル、操作ボタン
- **フィルタ部**: 検索条件入力エリア
- **一覧表示部**: データグリッド
- **フッター部**: ページネーション、件数表示

### 2.2 操作ボタン
- **新規登録**: 新規登録画面へ遷移
- **印刷**: 一覧を印刷用フォーマットで出力

## 3. 表示項目定義

### 3.1 一覧表示項目

| No. | 項目名（画面表示） | コントロールソース（DBフィールド） | データ型 | 表示形式 | 幅 | ソート | 備考 |
|----|------------------|----------------------------------|---------|----------|-----|--------|------|
| 1  | 選択 | - | チェックボックス | - | 30px | × | 複数選択可能 |
| 2  | 変化点No | [変化点NO] | nvarchar(20) | テキスト | 120px | ○ | 例: HPC25-0044 |
| 3  | 担当者 | [KH担当] | nvarchar | テキスト | 80px | ○ | 担当者名 |
| 4  | 初品納入予定日 | [KH初品納入変更日] | datetime | YYYY/MM/DD | 100px | ○ | 日付形式 |
| 5  | 初品納入実績初 | [KH初品納入実績初] | datetime | YYYY/MM/DD | 100px | ○ | 初回納入日 |
| 6  | 流動可否 | [流動可否] | nvarchar | テキスト | 60px | ○ | 可/否/保留 |
| 7  | 工程変更実施可否 | [工程変更実施可否] | nvarchar | テキスト | 100px | ○ | 可/否/検討中 |
| 8  | 起票部署 | [起票部署] | nvarchar(50) | テキスト | 100px | ○ | 例: TDK(株) |
| 9  | 品番 | [KH品番] | nvarchar(50) | テキスト | 120px | ○ | 製品番号 |
| 10 | 品名 | [KH品名] | nvarchar(100) | テキスト | 200px | ○ | 製品名称 |
| 11 | 納入予定日 | [納入予定日] | datetime | YYYY/MM/DD | 100px | ○ | - |
| 12 | 設変出図予定日 | [KH設変出図予定日] | datetime | YYYY/MM/DD | 100px | ○ | - |
| 13 | 設変出図実績日 | [KH設変出図実績日] | datetime | YYYY/MM/DD | 100px | ○ | - |
| 14 | 変更内容 | [変更内容] | nvarchar(255) | テキスト | 300px | × | ツールチップで全文表示 |
| 15 | 特採 | [特採後の処置] | int | テキスト | 50px | ○ | 0:なし 1:あり |
| 16 | 判定 | [流動判定日] | datetime | YYYY/MM/DD | 100px | ○ | 判定日付 |
| 17 | 工程変更予定日 | [切替基準日] | datetime | YYYY/MM/DD | 100px | ○ | - |
| 18 | 管理 | [KH管轄] | nvarchar | テキスト | 80px | ○ | 管理部署 |
| 19 | 工変受付No | [受付NO] | nvarchar | テキスト | 100px | ○ | 受付番号 |
| 20 | 速総番No | [連絡書NO] | nvarchar | テキスト | 100px | ○ | 連絡書番号 |
| 21 | 工変受付日 | [受付日] | datetime | YYYY/MM/DD | 100px | ○ | - |

### 3.2 表示制御
- **NULL値の表示**: 空文字として表示
- **日付フォーマット**: YYYY/MM/DD形式で統一
- **文字列の切り詰め**: 長い文字列は省略記号（...）で表示、ホバーで全文表示
- **行の色分け**: ステータスによる行の背景色変更（任意）

## 4. 検索・フィルタリング機能

### 4.1 検索条件

| 項目名 | 検索タイプ | 入力形式 | 備考 |
|--------|-----------|----------|------|
| 変化点No | 部分一致 | テキストボックス | - |
| 起票部署 | 部分一致 | テキストボックス | - |
| 品番 | 部分一致 | テキストボックス | - |
| 品名 | 部分一致 | テキストボックス | - |
| 担当者 | 部分一致 | テキストボックス | - |
| 受付日（From） | 範囲指定 | 日付ピッカー | - |
| 受付日（To） | 範囲指定 | 日付ピッカー | - |
| 流動可否 | 完全一致 | ドロップダウン | 可/否/全て |
| 工程変更実施可否 | 完全一致 | ドロップダウン | 可/否/全て |

### 4.2 検索処理
- **検索ボタン**: 条件に基づいてデータを再取得
- **クリアボタン**: 全検索条件をリセット
- **検索条件の保持**: ページング時も検索条件を保持

## 5. ソート機能

### 5.1 ソート対象
- ソート可能な項目はヘッダークリックでソート
- 昇順/降順の切り替え
- 複数項目でのソート（Ctrlキー押下）

### 5.2 デフォルトソート
- 初期表示: 受付日の降順（最新のデータが上位）

## 6. ページネーション

### 6.1 表示件数
- 1ページあたりの表示件数: 50件（変更可能：25/50/100件）
- 全件数の表示: 「全XXX件中 XX-XX件を表示」

### 6.2 ページ移動
- 前へ/次へボタン
- ページ番号の直接指定
- 最初/最後へのジャンプ

## 7. データ操作

### 7.1 行選択時の動作
- **シングルクリック**: 行選択
- **ダブルクリック**: 詳細画面へ遷移
- **右クリック**: コンテキストメニュー表示（編集/削除/複製）

### 7.2 一括操作
- 複数選択した行に対する一括操作
- 一括削除（確認ダイアログ付き）
- 一括エクスポート（CSV/Excel）

## 8. 性能要件

### 8.1 レスポンスタイム
- 初期表示: 3秒以内
- ページング: 1秒以内
- 検索実行: 3秒以内

### 8.2 最大表示件数
- 一度に取得する最大件数: 1000件
- それ以上の場合は条件絞り込みを促すメッセージ表示

## 9. エラー処理

### 9.1 エラー種別と対応
- **データ取得エラー**: エラーメッセージを表示し、再試行ボタンを表示
- **検索結果0件**: 「該当データがありません」メッセージ表示
- **セッションタイムアウト**: ログイン画面へリダイレクト

## 10. 権限制御

### 10.1 表示権限
- 全ユーザー: 一覧表示可能
- 編集権限者: 編集・削除ボタン表示
- 管理者: 全機能利用可能

## 11. その他の要件

### 11.1 ブラウザ対応
- Chrome（最新版）
- Edge（最新版）
- Firefox（最新版）

### 11.2 レスポンシブ対応
- 最小幅: 1280px
- タブレット対応は将来検討

### 11.3 アクセシビリティ
- キーボード操作対応
- スクリーンリーダー対応（基本レベル）

## 12. 画面遷移

### 12.1 遷移先画面
- **新規登録ボタン**: 登録画面（register_modern_new.html）
- **行ダブルクリック**: 詳細/編集画面（未実装）
- **印刷ボタン**: 印刷プレビュー画面（別ウィンドウ）

## 13. 実装技術

### 13.1 フロントエンド
- HTML5 + CSS3
- JavaScript (ES6+)
- Bootstrap 5
- DataTables または AG-Grid

### 13.2 バックエンド
- Flask (Python)
- SQLAlchemy ORM
- pymssql (データベース接続)

### 13.3 API仕様
- **一覧取得**: GET /api/changes/list
- **検索**: POST /api/changes/search
- **削除**: DELETE /api/changes/{id}

## 改訂履歴

| 版数 | 日付 | 作成者 | 変更内容 |
|------|------|--------|----------|
| 1.0 | 2025/01/21 | Claude | 初版作成 |